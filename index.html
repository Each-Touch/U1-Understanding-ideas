<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åˆä¸­è‹±è¯­ç‚¹è¯»æœ¬ - æ‰‹æœºå¢å¼ºç‰ˆ</title>
    <style>
        :root { --main-brown: #8b4513; --bg-color: #fdf6e3; --text-color: #333; --highlight: #fff9db; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg-color); padding: 10px; margin: 0; color: var(--text-color); -webkit-tap-highlight-color: transparent; }
        
        .container { max-width: 100%; margin: 0 auto; background: white; padding: 20px 15px; border-radius: 0 0 15px 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        /* æ‰‹æœºç«¯æ§åˆ¶é¢æ¿ä¼˜åŒ– */
        .controls { position: sticky; top: 0; background: #fff; padding: 15px 10px; z-index: 1000; border-bottom: 2px solid #eee; display: flex; flex-direction: column; gap: 12px; }
        .voice-row { display: flex; align-items: center; gap: 8px; overflow-x: auto; white-space: nowrap; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .voice-row::-webkit-scrollbar { display: none; } /* éšè—æ»šåŠ¨æ¡ */
        
        /* é’ˆå¯¹æ‰‹æœºç‚¹å‡»ä¼˜åŒ–çš„å‘éŸ³æŒ‰é’® */
        .voice-chip { padding: 6px 15px; background: #f0f0f0; border-radius: 18px; font-size: 13px; border: 1px solid #ddd; cursor: pointer; flex-shrink: 0; }
        .voice-chip.active { background: var(--main-brown); color: white; border-color: var(--main-brown); }

        .slider-row { display: flex; align-items: center; gap: 10px; font-size: 14px; }
        input[type="range"] { flex: 1; height: 6px; }

        /* æ–‡ç« å†…å®¹ */
        h1 { text-align: center; color: var(--main-brown); font-size: 20px; margin: 10px 0 20px; }
        .paragraph { margin-bottom: 35px; border-bottom: 1px dashed #eee; padding-bottom: 20px; }
        .para-num { font-size: 18px; color: #d2b48c; font-weight: bold; margin-bottom: 10px; display: block; }

        .sentence-wrap { display: block; margin-bottom: 22px; cursor: pointer; padding: 8px; border-radius: 8px; }
        .sentence-wrap:active { background: var(--highlight); } /* æ‰‹æœºç«¯ç‚¹å‡»åé¦ˆ */
        
        .en-line { display: flex; flex-wrap: wrap; gap: 2px 6px; margin-bottom: 8px; }
        .word-group { display: flex; flex-direction: column; align-items: center; }
        .en-word { font-size: 1.15em; font-weight: 500; line-height: 1.3; }
        .word-zh { font-size: 0.7em; color: #888; margin-top: 1px; }
        
        .sentence-zh { display: block; font-size: 0.9em; color: #5a7d5a; font-family: "PingFang SC", "STKaiti", serif; border-left: 2px solid #e0e0e0; padding-left: 8px; }

        /* å…¨æ–‡æœ—è¯»æ‚¬æµ®æŒ‰é’® */
        .fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: var(--main-brown); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 12px; font-weight: bold; text-align: center; line-height: 1.2; z-index: 999; }
    </style>
</head>
<body>

<div class="controls">
    <div class="slider-row">
        <span>ğŸ¢ è¯­é€Ÿ</span>
        <input type="range" id="rate" min="0.4" max="1.0" step="0.1" value="0.8">
        <span id="rateVal">0.8</span>
    </div>
    <div class="voice-row" id="voiceRow">
        <span style="font-size: 13px; color: #999;">æ­£åœ¨æœç´¢è¯­éŸ³åŒ…...</span>
    </div>
</div>

<div class="container">
    <h1>The Secrets of Happiness</h1>
    <div id="content"></div>
</div>

<div class="fab" onclick="readFullText()">æœ—è¯»<br>å…¨æ–‡</div>

<script>
    const synth = window.speechSynthesis;
    const voiceRow = document.getElementById('voiceRow');
    const rateInput = document.getElementById('rate');
    const rateVal = document.getElementById('rateVal');
    let voices = [];
    let selectedVoiceName = "";

    // æ›´æ–°è¯­é€Ÿæ•°å­—æ˜¾ç¤º
    rateInput.oninput = () => rateVal.innerText = rateInput.value;

    // 1. æ ¸å¿ƒæ•°æ® (ä¸ä¹‹å‰ä¿æŒä¸€è‡´)
    const article = [
        { num: 1, sentences: [
            { en: "I put down Charlie and the Chocolate Factory.", zh: "æˆ‘æ”¾ä¸‹äº†ã€ŠæŸ¥ç†å’Œå·§å…‹åŠ›å·¥å‚ã€‹ã€‚", words: {"I":"æˆ‘","put":"æ”¾ä¸‹","down":"æ”¾ä¸‹","Charlie":"æŸ¥ç†","and":"å’Œ","the":"è¿™","Chocolate":"å·§å…‹åŠ›","Factory":"å·¥å‚"} },
            { en: "But I kept going over the exciting story in my mind.", zh: "ä½†æˆ‘è„‘æµ·é‡Œä»åœ¨åå¤å›å‘³é‚£ä¸ªä»¤äººå…´å¥‹çš„æ•…äº‹ã€‚", words: {"But":"ä½†","kept":"ä¿æŒ","going":"ç»§ç»­","over":"åå¤","exciting":"å…´å¥‹çš„","story":"æ•…äº‹","in":"åœ¨","my":"æˆ‘çš„","mind":"è„‘æµ·"} },
            { en: "The book was full of magic.", zh: "è¿™æœ¬ä¹¦å……æ»¡äº†é­”åŠ›ã€‚", words: {"The":"è¿™","book":"ä¹¦","was":"æ˜¯","full":"å……æ»¡","of":"çš„","magic":"é­”åŠ›"} },
            { en: "But Charlie's happy family was the most magical part of the story.", zh: "ä½†æŸ¥ç†å¹¸ç¦çš„å®¶åº­æ‰æ˜¯æ•…äº‹ä¸­æœ€ç¥å¥‡çš„éƒ¨åˆ†ã€‚", words: {"But":"ä½†","Charlie's":"æŸ¥ç†çš„","happy":"å¹¸ç¦çš„","family":"å®¶åº­","was":"æ˜¯","the":"æœ€","most":"æœ€","magical":"ç¥å¥‡çš„","part":"éƒ¨åˆ†","of":"çš„","story":"æ•…äº‹"} }
        ]},
        { num: 2, sentences: [
            { en: "Charlie's home was a small house at the side of a big town.", zh: "æŸ¥ç†çš„å®¶æ˜¯å°é•‡è¾¹ä¸Šçš„ä¸€ä¸ªå°æˆ¿å­ã€‚", words: {"home":"å®¶","was":"æ˜¯","small":"å°çš„","house":"æˆ¿å­","at":"åœ¨","side":"æ—è¾¹","big":"å¤§çš„","town":"åŸé•‡"} },
            { en: "His family was very poor.", zh: "ä»–çš„å®¶åº­éå¸¸è´«ç©·ã€‚", words: {"His":"ä»–çš„","family":"å®¶åº­","was":"æ˜¯","very":"éå¸¸","poor":"è´«ç©·"} },
            { en: "His four grandparents stayed in the only bed in the house.", zh: "ä»–çš„å››ä½ç¥–çˆ¶æ¯å¾…åœ¨å®¶é‡Œå”¯ä¸€çš„åºŠä¸Šã€‚", words: {"four":"å››ä¸ª","grandparents":"ç¥–çˆ¶æ¯","stayed":"å¾…åœ¨","in":"åœ¨","only":"å”¯ä¸€çš„","bed":"åºŠ"} },
            { en: "The family never had enough food.", zh: "è¿™ä¸ªå®¶åº­ä»æ¥æ²¡æœ‰è¶³å¤Ÿçš„é£Ÿç‰©ã€‚", words: {"family":"å®¶åº­","never":"ä»ä¸","had":"æœ‰","enough":"è¶³å¤Ÿçš„","food":"é£Ÿç‰©"} },
            { en: "They always ate watery cabbage soup for dinner.", zh: "ä»–ä»¬æ™šé¤æ€»æ˜¯å–ç¨€è–„çš„å·å¿ƒèœæ±¤ã€‚", words: {"They":"ä»–ä»¬","always":"æ€»æ˜¯","ate":"åƒ","watery":"ç¨€è–„çš„","cabbage":"å·å¿ƒèœ","soup":"æ±¤","for":"ä½œä¸º","dinner":"æ™šé¤"} },
            { en: "In winter, the freezing wind swept across the floor all night long.", zh: "å†¬å¤©ï¼Œåˆºéª¨çš„å¯’é£æ•´æ™šæ¨ªæ‰«åœ°æ¿ã€‚", words: {"In":"åœ¨","winter":"å†¬å¤©","freezing":"åˆºéª¨çš„","wind":"å¯’é£","swept":"æ¨ªæ‰«","across":"ç©¿è¿‡","floor":"åœ°æ¿","all":"æ•´ä¸ª","night":"æ™šä¸Š","long":"é•¿"} }
        ]},
        { num: 3, sentences: [
            { en: "To my surprise, the family were happy together.", zh: "ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œå…¨å®¶äººåœ¨ä¸€èµ·å¾ˆå¹¸ç¦ã€‚", words: {"To":"ä»¤","my":"æˆ‘çš„","surprise":"æƒŠè®¶","family":"å®¶äºº","were":"æ˜¯","happy":"å¹¸ç¦","together":"åœ¨ä¸€èµ·"} },
            { en: "In the evenings, Charlie sat with his grandparents in bed and listened to their stories.", zh: "åœ¨æ™šä¸Šï¼ŒæŸ¥ç†å’Œç¥–çˆ¶æ¯ååœ¨åºŠä¸Šå¬ä»–ä»¬è®²æ•…äº‹ã€‚", words: {"evenings":"æ™šä¸Š","sat":"å","with":"å’Œ","grandparents":"ç¥–çˆ¶æ¯","listened":"å¬","stories":"æ•…äº‹"} },
            { en: "Charlie's parents often joined in.", zh: "æŸ¥ç†çš„çˆ¶æ¯ä¹Ÿç»å¸¸åŠ å…¥è¿›æ¥ã€‚", words: {"parents":"çˆ¶æ¯","often":"ç»å¸¸","joined":"åŠ å…¥","in":"ä¸­"} },
            { en: "Every night, the room became a happy place.", zh: "æ¯å¤©æ™šä¸Šï¼Œæˆ¿é—´éƒ½å˜æˆäº†ä¸€ä¸ªå¿«ä¹çš„åœ°æ–¹ã€‚", words: {"Every":"æ¯","night":"æ™š","room":"æˆ¿é—´","became":"å˜æˆ","happy":"å¿«ä¹","place":"åœ°æ–¹"} },
            { en: "The whole family forgot about their hungry and poor life.", zh: "å…¨å®¶äººéƒ½å¿˜è®°äº†ä»–ä»¬é¥¥é¥¿è´«å›°çš„ç”Ÿæ´»ã€‚", words: {"whole":"æ•´ä¸ª","family":"å®¶äºº","forgot":"å¿˜è®°","about":"å…³äº","hungry":"é¥¥é¥¿","poor":"è´«ç©·","life":"ç”Ÿæ´»"} }
        ]},
        { num: 4, sentences: [
            { en: "This touched me greatly.", zh: "è¿™æå¤§åœ°è§¦åŠ¨äº†æˆ‘ã€‚", words: {"This":"è¿™","touched":"è§¦åŠ¨","me":"æˆ‘","greatly":"æå¤§åœ°"} },
            { en: "In some people's minds, happiness comes from things like money.", zh: "åœ¨ä¸€äº›äººçš„å¿ƒç›®ä¸­ï¼Œå¹¸ç¦æ¥è‡ªé‡‘é’±ä¹‹ç±»çš„äº‹ç‰©ã€‚", words: {"some":"ä¸€äº›","minds":"å¿ƒç›®","happiness":"å¹¸ç¦","comes":"æ¥è‡ª","from":"ä»","things":"äº‹ç‰©","like":"åƒ","money":"é‡‘é’±"} },
            { en: "But love, in fact, is the key to happiness.", zh: "ä½†çˆ±ï¼Œäº‹å®ä¸Šï¼Œæ˜¯å¹¸ç¦çš„å…³é”®ã€‚", words: {"But":"ä½†","love":"çˆ±","in":"åœ¨","fact":"äº‹å®","is":"æ˜¯","key":"å…³é”®","to":"å¯¹äº"} },
            { en: "Oscar Wilde once said, 'Keep love in your heart.'", zh: "å¥¥æ–¯å¡Â·ç‹å°”å¾·æ›¾è¯´è¿‡ï¼šâ€˜æŠŠçˆ±ç•™åœ¨å¿ƒé‡Œã€‚â€™", words: {"said":"è¯´","Keep":"ä¿æŒ","love":"çˆ±","your":"ä½ çš„","heart":"å¿ƒ"} },
            { en: "A life without it is like a sunless garden...", zh: "æ²¡æœ‰çˆ±çš„ç”Ÿæ´»å°±åƒä¸€åº§æ²¡æœ‰é˜³å…‰çš„èŠ±å›­â€¦â€¦", words: {"life":"ç”Ÿæ´»","without":"æ²¡æœ‰","it":"å®ƒ","like":"åƒ","sunless":"æ— é˜³å…‰","garden":"èŠ±å›­"} },
            { en: "I think love is the most important one.", zh: "æˆ‘è®¤ä¸ºçˆ±æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªï¼ˆåŸå› ï¼‰ã€‚", words: {"think":"è®¤ä¸º","love":"çˆ±","most":"æœ€","important":"é‡è¦","one":"ä¸€ä¸ª"} },
            { en: "It can move us, change us and give us a life full of happiness.", zh: "å®ƒå¯ä»¥æ„ŸåŠ¨æˆ‘ä»¬ï¼Œæ”¹å˜æˆ‘ä»¬ï¼Œç»™æˆ‘ä»¬ä¸€ä¸ªå……æ»¡å¹¸ç¦çš„ç”Ÿæ´»ã€‚", words: {"move":"ç§»åŠ¨/æ„ŸåŠ¨","us":"æˆ‘ä»¬","change":"æ”¹å˜","give":"ç»™äºˆ","full":"å……æ»¡"} }
        ]}
    ];

    // 2. è¯­éŸ³é€‰æ‹©é€»è¾‘ (ä¿®å¤ç§»åŠ¨ç«¯åŠ è½½)
    function initVoices() {
        voices = synth.getVoices().filter(v => v.lang.includes('en'));
        if (voices.length === 0) return;
        
        voiceRow.innerHTML = voices.map((v, i) => {
            const shortName = v.name.split(' ')[1] || v.name.substring(0,8);
            return `<div class="voice-chip ${i===0?'active':''}" onclick="setVoice(this, '${v.name}')">${shortName}</div>`;
        }).join('');
        
        if (!selectedVoiceName) selectedVoiceName = voices[0].name;
    }

    function setVoice(el, name) {
        document.querySelectorAll('.voice-chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        selectedVoiceName = name;
        // æ‰‹æœºç«¯é€šå¸¸éœ€è¦ä¸€ä¸ªé™éŸ³æ’­æ”¾æ¥â€œæ¿€æ´»â€
        speak(""); 
    }

    // 3. æ¸²æŸ“é¡µé¢
    function render() {
        const container = document.getElementById('content');
        article.forEach(p => {
            let html = `<div class="paragraph"><span class="para-num">Part ${p.num}</span>`;
            p.sentences.forEach(s => {
                let wordsHtml = s.en.split(' ').map(raw => {
                    let clean = raw.replace(/[.,'â€™!?;]/g, '');
                    let zh = s.words[clean] || s.words[raw] || "";
                    return `<div class="word-group" onclick="event.stopPropagation(); speak('${clean}')">
                                <span class="en-word">${raw}</span>
                                <span class="word-zh">${zh}</span>
                            </div>`;
                }).join('');
                html += `<div class="sentence-wrap" onclick="speak('${s.en.replace(/'/g, "\\'")}')">
                            <div class="en-line">${wordsHtml}</div>
                            <div class="sentence-zh">${s.zh}</div>
                         </div>`;
            });
            html += `</div>`;
            container.innerHTML += html;
        });
    }

    function speak(text) {
        if (!text && !selectedVoiceName) return;
        synth.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        const v = voices.find(v => v.name === selectedVoiceName);
        if (v) utter.voice = v;
        utter.rate = rateInput.value;
        synth.speak(utter);
    }

    function readFullText() {
        const all = article.flatMap(p => p.sentences.map(s => s.en)).join(' ');
        speak(all);
    }

    // å¤„ç† Chrome/iOS è¯­éŸ³åŠ è½½å»¶è¿Ÿ
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = initVoices;
    }
    window.onload = () => {
        render();
        setTimeout(initVoices, 100); 
    };
</script>
</body>
</html>
